<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>Chessboard Tests</title>
  <link rel="stylesheet" href="./assets/xiangqiboard.css" />
</head>
<body>
<div style="width: 1290px;">
    <div id="myBoard1" style="width: 50%;float: left;"></div>
</div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="./assets/xiangqiboard.js"></script>
  <script src="./assets/xiangqi.min.js"></script>
  <script>

    (() => {

      const game = new Xiangqi;

      const config = {
          boardTheme: './docs/img/xiangqiboards/wikimedia/xiangqiboard.svg',
          pieceTheme: './docs/img/xiangqipieces/wikimedia/{piece}.svg',
          orientation: 'white',
          position: game.fen(),
          showNotation: true
      }

      let board = Xiangqiboard("#myBoard1", config);

      let _selecting;
      let _moves;
      let _el_selecting;

      function hasMove(moves, move) {
        for (let i in moves) {
            if(moves[i] === move) {
                return true;
            }
        }
      }

      $('.square-2b8ce').click(function() {
          let square = $(this).data('square');
          let moves = game.moves({square});
          let move =  _selecting + square;

          // Các vị trí có thể đi
          // console.dir(moves); 

          // Hiển thị vị trí đã chọn
          // console.log(square, _moves, move, _selecting);

          if(_selecting && hasMove(_moves, move)) {
            _selecting = null;
            _moves = null;

            // hiển thị chuỗi nước đi đã chọn
            // console.log(move);

            game.move(move);
            board.position(game.fen());
          }

          if(moves.length) {
              _el_selecting ? _el_selecting.classList.remove('selecting'): '';
              this.classList.add('selecting');
              _el_selecting = this;
              _selecting = square;
              _moves = moves;
          }
      })

    })();
  </script>
</body>
</html>
